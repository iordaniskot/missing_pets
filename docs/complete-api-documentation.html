<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete API Documentation - Missing Pets</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.2.12/marked.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
        color: #333;
      }
      h1,
      h2,
      h3,
      h4 {
        color: #2c3e50;
      }
      h1 {
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
      }
      h2 {
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
      }
      code {
        background-color: #f4f4f4;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", Courier, monospace;
      }
      pre code {
        display: block;
        padding: 10px;
        background-color: #2d2d2d;
        color: #f8f8f2;
        border-radius: 4px;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .container {
        max-width: 900px;
        margin: auto;
      }
      nav {
        background-color: #f8f8f8;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      nav ul {
        list-style-type: none;
        padding: 0;
      }
      nav ul li {
        display: inline;
        margin-right: 15px;
      }
      nav ul li a {
        text-decoration: none;
        color: #007bff;
      }
      nav ul li a:hover {
        text-decoration: underline;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      .endpoint {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
      }
      .endpoint h3 {
        margin-top: 0;
        color: #3498db;
      }
      .method {
        font-weight: bold;
        padding: 3px 8px;
        border-radius: 3px;
        color: white;
        margin-right: 10px;
      }
      .post {
        background-color: #4caf50;
      }
      .get {
        background-color: #2196f3;
      }
      .patch {
        background-color: #ff9800;
      }
      .delete {
        background-color: #f44336;
      }
      .request-body,
      .response,
      .query-params,
      .ws-event {
        margin-top: 10px;
      }
      .request-body strong,
      .response strong,
      .query-params strong,
      .ws-event strong {
        display: block;
        margin-bottom: 5px;
      }
      /* Styles for Markdown content */
      #markdown-content h1,
      #markdown-content h2,
      #markdown-content h3,
      #markdown-content h4,
      #markdown-content h5,
      #markdown-content h6 {
        margin-top: 24px;
        margin-bottom: 16px;
        font-weight: 600;
        line-height: 1.25;
      }
      #markdown-content h1 {
        font-size: 2em;
        border-bottom: 1px solid #eaecef;
        padding-bottom: 0.3em;
      }
      #markdown-content h2 {
        font-size: 1.5em;
        border-bottom: 1px solid #eaecef;
        padding-bottom: 0.3em;
      }
      #markdown-content h3 {
        font-size: 1.25em;
      }
      #markdown-content h4 {
        font-size: 1em;
      }
      #markdown-content p {
        margin-bottom: 16px;
      }
      #markdown-content ul,
      #markdown-content ol {
        padding-left: 2em;
        margin-bottom: 16px;
      }
      #markdown-content li {
        margin-bottom: 0.25em;
      }
      #markdown-content blockquote {
        margin: 0 0 16px;
        padding: 0 1em;
        color: #6a737d;
        border-left: 0.25em solid #dfe2e5;
      }
      #markdown-content table {
        display: block;
        width: 100%;
        overflow: auto;
        margin-bottom: 16px;
        border-spacing: 0;
        border-collapse: collapse;
      }
      #markdown-content th,
      #markdown-content td {
        padding: 6px 13px;
        border: 1px solid #dfe2e5;
      }
      #markdown-content tr {
        background-color: #fff;
        border-top: 1px solid #c6cbd1;
      }
      #markdown-content tr:nth-child(2n) {
        background-color: #f6f8fa;
      }
      #markdown-content img {
        max-width: 100%;
        height: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li>
            <a href="attachment-upload-documentation.html"
              >Attachment Upload Docs</a
            >
          </li>
        </ul>
      </nav>

      <h1>Complete API Documentation</h1>

      <div id="markdown-content">
        <!-- Markdown content will be injected here -->
      </div>
    </div>

    <script>
      const markdownText = `
# Missing Pets Backend API

A comprehensive RESTful API for a Missing Pets application built with Node.js, Express.js, MongoDB, and Socket.io. This backend enables users to register, manage pets, and report missing or found pets with real-time updates and geospatial search capabilities.

## üöÄ Features

- **User Management**: Registration, authentication (JWT), profile management (including admin routes).
- **Pet CRUD**: Create, read, update, delete pet records with detailed characteristics.
- **Report System**: Lost, found, and reunited pet reports with geospatial location.
- **Real-time Updates**: Socket.io integration for live notifications on report creation and updates within subscribed regions.
- **File Uploads**: Photo upload support for pets and reports, served via a CDN-like path.
- **Geospatial Search**: Radius-based search for nearby reports.
- **Security**: JWT authentication, password hashing (bcryptjs), rate limiting, input validation, CORS.
- **Logging**: Comprehensive logging with Winston.
- **Health Check**: Endpoint to monitor application status.

## üõ†Ô∏è Tech Stack

- **Runtime**: Node.js (as specified in \`package.json\`)
- **Framework**: Express.js
- **Database**: MongoDB Atlas via Mongoose
- **Real-Time**: Socket.io
- **Authentication**: JSON Web Tokens (jsonwebtoken)
- **Password Hashing**: bcryptjs
- **File Uploads**: Multer
- **Validation**: express-validator
- **Logging**: Winston
- **Environment Management**: dotenv
- **CORS**: cors package
- **HTTP Server**: Node.js \`http\` module

## üìö API Documentation

All API endpoints requiring authentication must include an \`Authorization\` header with a Bearer token: \`Authorization: Bearer <your-jwt-token>\`.

### Authentication Endpoints

#### \`POST /auth/signup\`
Register a new user account.
**Request Body:**
\'\'\'json
{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123",
  "phone": "+1234567890"
}
\'\'\'
**Response (Success 201):**
\'\'\'json
{
  "message": "User created successfully",
  "token": "jwt-token-here",
  "user": {
    "_id": "user-id",
    "name": "John Doe",
    "email": "john@example.com",
    "phone": "+1234567890"
  }
}
\'\'\'

#### \`POST /auth/login\`
Authenticate user and get an access token.
**Request Body:**
\'\'\'json
{
  "email": "john@example.com",
  "password": "password123"
}
\'\'\'
**Response (Success 200):**
\'\'\'json
{
  "message": "Logged in successfully",
  "token": "jwt-token-here",
  "user": {
    "_id": "user-id",
    "name": "John Doe",
    "email": "john@example.com",
    "phone": "+1234567890"
  }
}
\'\'\'

### User Endpoints (Authentication Required)

#### \`GET /users/me\`
Get the profile of the currently authenticated user.
**Response (Success 200):** User object.

#### \`PATCH /users/me\`
Update the profile of the currently authenticated user.
**Request Body:** Fields to update (e.g., name, phone, password).
**Response (Success 200):** Updated user object.

#### \`DELETE /users/me\`
Delete the account of the currently authenticated user.
**Response (Success 200):** Confirmation message.

### Admin User Endpoints (Authentication Required, Admin Privileges)

#### \`GET /users\`
List all users (pagination available).
**Query Parameters:**
- \`page\` (number, optional): Page number for pagination.
- \`limit\` (number, optional): Number of items per page.
**Response (Success 200):** Array of user objects.

#### \`GET /users/:id\`
Get a specific user by ID.
**Response (Success 200):** User object.

#### \`PATCH /users/:id\`
Update a specific user by ID.
**Request Body:** Fields to update.
**Response (Success 200):** Updated user object.

#### \`DELETE /users/:id\`
Delete a specific user by ID.
**Response (Success 200):** Confirmation message.

### Pet Endpoints (Authentication Required)

#### \`POST /pets\`
Create a new pet record.
**Request Body (\`multipart/form-data\`):**
- \`name\` (String)
- \`breed\` (String, optional)
- \`height\` (Number, optional)
- \`weight\` (Number, optional)
- \`color\` (String, optional)
- \`attachments\` (File, optional): Pet photo(s).
**Response (Success 201):** Created pet object.

#### \`GET /pets\`
List pets (pagination and filters available).
**Query Parameters:**
- \`page\` (number, optional)
- \`limit\` (number, optional)
- \`name\` (String, optional): Filter by pet name.
- \`breed\` (String, optional): Filter by pet breed.
- \`color\` (String, optional): Filter by pet color.
- \`hasOwner\` (Boolean, optional): Filter pets that have an owner.
**Response (Success 200):** Array of pet objects.

#### \`GET /pets/:id\`
Get a specific pet by ID.
**Response (Success 200):** Pet object.

#### \`PATCH /pets/:id\`
Update a specific pet by ID.
**Request Body (\`multipart/form-data\`):** Fields to update (same as POST).
**Response (Success 200):** Updated pet object.

#### \`DELETE /pets/:id\`
Delete a specific pet by ID.
**Response (Success 200):** Confirmation message.

### Report Endpoints (Authentication Required)

#### \`POST /reports\`
Create a new missing/found pet report.
**Request Body (\`multipart/form-data\`):**
- \`pet\` (String, Pet ID)
- \`status\` (String, enum: \`lost\`, \`found\`, \`reunited\`)
- \`description\` (String, optional)
- \`location\` (Object): GeoJSON Point (e.g., \`{ "type": "Point", "coordinates": [longitude, latitude] }\`)
- \`attachments\` (File, optional): Report photo(s).
**Response (Success 201):** Created report object.

#### \`GET /reports\`
List reports (pagination, filters, geospatial search available).
**Query Parameters:**
- \`page\` (number, optional)
- \`limit\` (number, optional)
- \`status\` (String, optional, enum: \`lost\`, \`found\`, \`reunited\`): Filter by report status.
- \`petId\` (String, optional): Filter by Pet ID.
- \`reporterId\` (String, optional): Filter by User ID of the reporter.
- \`dateFrom\` (String, optional, ISO Date): Filter reports from this date.
- \`dateTo\` (String, optional, ISO Date): Filter reports up to this date.
- \`lat\` (Number, optional): Latitude for geospatial search.
- \`lng\` (Number, optional): Longitude for geospatial search.
- \`radius\` (Number, optional): Search radius in meters (used with \`lat\` and \`lng\`).
**Response (Success 200):** Array of report objects.

#### \`GET /reports/:id\`
Get a specific report by ID.
**Response (Success 200):** Report object.

#### \`PATCH /reports/:id\`
Update a specific report by ID.
**Request Body (\`multipart/form-data\`):** Fields to update (same as POST).
**Response (Success 200):** Updated report object.

#### \`PATCH /reports/:id/found\`
Mark a specific report\'s pet as found (sets status to \`reunited\` or similar).
**Response (Success 200):** Updated report object.

#### \`DELETE /reports/:id\`
Delete a specific report by ID.
**Response (Success 200):** Confirmation message.

### Health Check

#### \`GET /health\`
Provides the health status of the server.
**Response (Success 200):**
\'\'\'json
{
  "status": "OK",
  "timestamp": "YYYY-MM-DDTHH:mm:ss.sssZ",
  "uptime": 1234.56 // seconds
}
\'\'\'

## üîå WebSocket Events

The API uses Socket.io for real-time communication, primarily for report updates.

-   **Namespace**: \`/reports\`
-   **Authentication**: Connect to the namespace with a JWT token in the \`auth\` object:
    \'\'\'javascript
    const socket = io(\'http://your-server-url/reports\', {
      auth: {
        token: \'your-jwt-token\'
      }
    });
    \'\'\'

### Emitted Events (Server to Client)

-   \`newReport\`
    -   **Payload**: The newly created report object.
    -   **Description**: Emitted when a new report is successfully created and matches a client\'s subscribed region.
-   \`updateReport\`
    -   **Payload**: The updated report object.
    -   **Description**: Emitted when an existing report is updated and matches a client\'s subscribed region.

### Listened Events (Client to Server)

-   \`subscribeRegion\`
    -   **Payload**:
        \'\'\'json
        {
          "lat": 40.7128,    // Latitude of the center of the region
          "lng": -74.0060,   // Longitude of the center of the region
          "radius": 5000     // Radius in meters
        }
        \'\'\'
    -   **Description**: Allows a client to subscribe to real-time updates for reports within a specific geographical area. The server will then only send \`newReport\` and \`updateReport\` events relevant to this region.

## üìä Data Models

All models include \`createdAt\` and \`updatedAt\` timestamps by default.

### User
- \`name\` (String, required)
- \`email\` (String, required, unique, lowercase, trim)
- \`password\` (String, required, minlength: 6) - Stored hashed.
- \`phone\` (String, optional, trim)
- \`isAdmin\` (Boolean, default: false)

### Pet
- \`owner\` (ObjectId, ref: 'User', optional, index: true) - The user who owns the pet.
- \`createdBy\` (ObjectId, ref: 'User', required, index: true) - The user who created the pet record.
- \`name\` (String, required, trim)
- \`breed\` (String, optional, trim)
- \`height\` (Number, optional, min: 0) - In cm.
- \`weight\` (Number, optional, min: 0) - In kg.
- \`color\` (String, optional, trim)
- \`photos\` (Array of String URLs, default: []) - URLs of pet photos.
- \`isOwnedByCreator\` (Boolean, default: true) - Indicates if the creator is the current owner.

### Report
- \`pet\` (ObjectId, ref: 'Pet', required, index: true) - The pet this report is about.
- \`reporter\` (ObjectId, ref: 'User', required, index: true) - The user who filed the report.
- \`status\` (String, required, enum: ['lost', 'found', 'reunited'], default: 'lost', index: true)
- \`description\` (String, optional, trim)
- \`photos\` (Array of String URLs, default: []) - URLs of report-specific photos.
- \`location\` (Object, required) - GeoJSON Point for the report\'s location.
    - \`type\` (String, enum: ['Point'], required)
    - \`coordinates\` (Array of Number, required, index: '2dsphere') - [longitude, latitude]
- \`resolvedAt\` (Date, optional) - When the report was marked as 'reunited'.

        \`;

        document.getElementById('markdown-content').innerHTML = marked.parse(markdownText);
        hljs.highlightAll();
`;
      </script>
      <script>
        // Initialize highlight.js for code highlighting
        hljs.highlightAll();
      </script>
    </script>
  </body>
</html>
