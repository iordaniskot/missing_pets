<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete API Documentation - Missing Pets</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <!-- marked.js script is no longer needed here -->
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
        color: #333;
      }
      h1,
      h2,
      h3,
      h4 {
        color: #2c3e50;
      }
      h1 {
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
      }
      h2 {
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
      }
      code {
        background-color: #f4f4f4;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", Courier, monospace;
      }
      pre code {
        display: block;
        padding: 10px;
        background-color: #2d2d2d;
        color: #f8f8f2;
        border-radius: 4px;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .container {
        max-width: 900px;
        margin: auto;
      }
      nav {
        background-color: #f8f8f8;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      nav ul {
        list-style-type: none;
        padding: 0;
      }
      nav ul li {
        display: inline;
        margin-right: 15px;
      }
      nav ul li a {
        text-decoration: none;
        color: #007bff;
      }
      nav ul li a:hover {
        text-decoration: underline;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      .endpoint {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
      }
      .endpoint h3 {
        margin-top: 0;
        color: #3498db;
      }
      .method {
        font-weight: bold;
        padding: 3px 8px;
        border-radius: 3px;
        color: white;
        margin-right: 10px;
      }
      .post {
        background-color: #4caf50;
      }
      .get {
        background-color: #2196f3;
      }
      .patch {
        background-color: #ff9800;
      }
      .delete {
        background-color: #f44336;
      }
      .request-body,
      .response,
      .query-params,
      .ws-event {
        margin-top: 10px;
      }
      .request-body strong,
      .response strong,
      .query-params strong,
      .ws-event strong {
        display: block;
        margin-bottom: 5px;
      }
      /* Styles for Markdown content */
      #markdown-content h1, /* Though top-level H1 is outside this div */
      #markdown-content h2,
      #markdown-content h3,
      #markdown-content h4,
      #markdown-content h5,
      #markdown-content h6 {
        margin-top: 24px;
        margin-bottom: 16px;
        font-weight: 600;
        line-height: 1.25;
      }
      #markdown-content h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: .3em;}
      #markdown-content h3 { font-size: 1.25em; }
      #markdown-content h4 { font-size: 1em; }
      #markdown-content p { margin-bottom: 16px; }
      #markdown-content ul, #markdown-content ol { padding-left: 2em; margin-bottom: 16px; }
      #markdown-content li { margin-bottom: .25em; }
      #markdown-content blockquote { margin: 0 0 16px; padding: 0 1em; color: #6a737d; border-left: .25em solid #dfe2e5;}
      #markdown-content table { display: block; width: 100%; overflow: auto; margin-bottom: 16px; border-spacing: 0; border-collapse: collapse; }
      #markdown-content th, #markdown-content td { padding: 6px 13px; border: 1px solid #dfe2e5; }
      #markdown-content tr { background-color: #fff; border-top: 1px solid #c6cbd1; }
      #markdown-content tr:nth-child(2n) { background-color: #f6f8fa; }
      #markdown-content img { max-width:100%; height:auto; }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="attachment-upload-documentation.html">Attachment Upload Docs</a></li>
            </ul>
        </nav>

        <h1>Complete API Documentation</h1>

        <div id="markdown-content">
            <h2 id="api-documentation">ðŸ“š API Documentation</h2>
            <p>All API endpoints requiring authentication must include an <code>Authorization</code> header with a Bearer token: <code>Authorization: Bearer &lt;your-jwt-token&gt;</code>.</p>

            <h3 id="authentication-endpoints">Authentication Endpoints</h3>

            <h4 id="post-auth-signup"><code>POST /auth/signup</code></h4>
            <p>Register a new user account.</p>
            <p><strong>Request Body:</strong></p>
            <pre><code class="language-json">{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123",
  "phone": "+1234567890"
}</code></pre>
            <p><strong>Response (Success 201):</strong></p>
            <pre><code class="language-json">{
  "message": "User created successfully",
  "token": "jwt-token-here",
  "user": {
    "_id": "user-id",
    "name": "John Doe",
    "email": "john@example.com",
    "phone": "+1234567890"
  }
}</code></pre>

            <h4 id="post-auth-login"><code>POST /auth/login</code></h4>
            <p>Authenticate user and get an access token.</p>
            <p><strong>Request Body:</strong></p>
            <pre><code class="language-json">{
  "email": "john@example.com",
  "password": "password123"
}</code></pre>
            <p><strong>Response (Success 200):</strong></p>
            <pre><code class="language-json">{
  "message": "Logged in successfully",
  "token": "jwt-token-here",
  "user": {
    "_id": "user-id",
    "name": "John Doe",
    "email": "john@example.com",
    "phone": "+1234567890"
  }
}</code></pre>

            <h3 id="user-endpoints-authentication-required">User Endpoints (Authentication Required)</h3>

            <h4 id="get-users-me"><code>GET /users/me</code></h4>
            <p>Get the profile of the currently authenticated user.</p>
            <p><strong>Response (Success 200):</strong> User object.</p>

            <h4 id="patch-users-me"><code>PATCH /users/me</code></h4>
            <p>Update the profile of the currently authenticated user.</p>
            <p><strong>Request Body:</strong> Fields to update (e.g., name, phone, password).</p>
            <p><strong>Response (Success 200):</strong> Updated user object.</p>

            <h4 id="delete-users-me"><code>DELETE /users/me</code></h4>
            <p>Delete the account of the currently authenticated user.</p>
            <p><strong>Response (Success 200):</strong> Confirmation message.</p>

            <h3 id="admin-user-endpoints-authentication-required-admin-privileges">Admin User Endpoints (Authentication Required, Admin Privileges)</h3>

            <h4 id="get-users"><code>GET /users</code></h4>
            <p>List all users (pagination available).</p>
            <p><strong>Query Parameters:</strong></p>
            <ul>
                <li><code>page</code> (number, optional): Page number for pagination.</li>
                <li><code>limit</code> (number, optional): Number of items per page.</li>
            </ul>
            <p><strong>Response (Success 200):</strong> Array of user objects.</p>

            <h4 id="get-users-id"><code>GET /users/:id</code></h4>
            <p>Get a specific user by ID.</p>
            <p><strong>Response (Success 200):</strong> User object.</p>

            <h4 id="patch-users-id"><code>PATCH /users/:id</code></h4>
            <p>Update a specific user by ID.</p>
            <p><strong>Request Body:</strong> Fields to update.</p>
            <p><strong>Response (Success 200):</strong> Updated user object.</p>

            <h4 id="delete-users-id"><code>DELETE /users/:id</code></h4>
            <p>Delete a specific user by ID.</p>
            <p><strong>Response (Success 200):</strong> Confirmation message.</p>

            <h3 id="pet-endpoints-authentication-required">Pet Endpoints (Authentication Required)</h3>

            <h4 id="post-pets"><code>POST /pets</code></h4>
            <p>Create a new pet record.</p>
            <p><strong>Request Body (<code>multipart/form-data</code>):</strong></p>
            <ul>
                <li><code>name</code> (String)</li>
                <li><code>breed</code> (String, optional)</li>
                <li><code>height</code> (Number, optional)</li>
                <li><code>weight</code> (Number, optional)</li>
                <li><code>color</code> (String, optional)</li>
                <li><code>attachments</code> (File, optional): Pet photo(s).</li>
            </ul>
            <p><strong>Response (Success 201):</strong> Created pet object.</p>

            <h4 id="get-pets"><code>GET /pets</code></h4>
            <p>List pets (pagination and filters available).</p>
            <p><strong>Query Parameters:</strong></p>
            <ul>
                <li><code>page</code> (number, optional)</li>
                <li><code>limit</code> (number, optional)</li>
                <li><code>name</code> (String, optional): Filter by pet name.</li>
                <li><code>breed</code> (String, optional): Filter by pet breed.</li>
                <li><code>color</code> (String, optional): Filter by pet color.</li>
                <li><code>hasOwner</code> (Boolean, optional): Filter pets that have an owner.</li>
            </ul>
            <p><strong>Response (Success 200):</strong> Array of pet objects.</p>

            <h4 id="get-pets-id"><code>GET /pets/:id</code></h4>
            <p>Get a specific pet by ID.</p>
            <p><strong>Response (Success 200):</strong> Pet object.</p>

            <h4 id="patch-pets-id"><code>PATCH /pets/:id</code></h4>
            <p>Update a specific pet by ID.</p>
            <p><strong>Request Body (<code>multipart/form-data</code>):</strong> Fields to update (same as POST).</p>
            <p><strong>Response (Success 200):</strong> Updated pet object.</p>

            <h4 id="delete-pets-id"><code>DELETE /pets/:id</code></h4>
            <p>Delete a specific pet by ID.</p>
            <p><strong>Response (Success 200):</strong> Confirmation message.</p>

            <h3 id="report-endpoints-authentication-required">Report Endpoints (Authentication Required)</h3>

            <h4 id="post-reports"><code>POST /reports</code></h4>
            <p>Create a new missing/found pet report.</p>
            <p><strong>Request Body (<code>multipart/form-data</code>):</strong></p>
            <ul>
                <li><code>pet</code> (String, Pet ID)</li>
                <li><code>status</code> (String, enum: <code>lost</code>, <code>found</code>, <code>reunited</code>)</li>
                <li><code>description</code> (String, optional)</li>
                <li><code>location</code> (Object): GeoJSON Point (e.g., <code>{ "type": "Point", "coordinates": [longitude, latitude] }</code>)</li>
                <li><code>attachments</code> (File, optional): Report photo(s).</li>
            </ul>
            <p><strong>Response (Success 201):</strong> Created report object.</p>

            <h4 id="get-reports"><code>GET /reports</code></h4>
            <p>List reports (pagination, filters, geospatial search available).</p>
            <p><strong>Query Parameters:</strong></p>
            <ul>
                <li><code>page</code> (number, optional)</li>
                <li><code>limit</code> (number, optional)</li>
                <li><code>status</code> (String, optional, enum: <code>lost</code>, <code>found</code>, <code>reunited</code>): Filter by report status.</li>
                <li><code>petId</code> (String, optional): Filter by Pet ID.</li>
                <li><code>reporterId</code> (String, optional): Filter by User ID of the reporter.</li>
                <li><code>dateFrom</code> (String, optional, ISO Date): Filter reports from this date.</li>
                <li><code>dateTo</code> (String, optional, ISO Date): Filter reports up to this date.</li>
                <li><code>lat</code> (Number, optional): Latitude for geospatial search.</li>
                <li><code>lng</code> (Number, optional): Longitude for geospatial search.</li>
                <li><code>radius</code> (Number, optional): Search radius in meters (used with <code>lat</code> and <code>lng</code>).</li>
            </ul>
            <p><strong>Response (Success 200):</strong> Array of report objects.</p>

            <h4 id="get-reports-id"><code>GET /reports/:id</code></h4>
            <p>Get a specific report by ID.</p>
            <p><strong>Response (Success 200):</strong> Report object.</p>

            <h4 id="patch-reports-id"><code>PATCH /reports/:id</code></h4>
            <p>Update a specific report by ID.</p>
            <p><strong>Request Body (<code>multipart/form-data</code>):</strong> Fields to update (same as POST).</p>
            <p><strong>Response (Success 200):</strong> Updated report object.</p>

            <h4 id="patch-reports-id-found"><code>PATCH /reports/:id/found</code></h4>
            <p>Mark a specific report's pet as found (sets status to <code>reunited</code> or similar).</p>
            <p><strong>Response (Success 200):</strong> Updated report object.</p>

            <h4 id="delete-reports-id"><code>DELETE /reports/:id</code></h4>
            <p>Delete a specific report by ID.</p>
            <p><strong>Response (Success 200):</strong> Confirmation message.</p>

            <h3 id="file-upload-details">File Upload Details</h3>
            <ul>
                <li>Files are uploaded via <code>multipart/form-data</code>.</li>
                <li>The field name for file(s) should be <code>attachments</code>.</li>
                <li>Uploaded files are stored in the <code>/attachments</code> directory on the server and accessible via <code>/attachments/:filename</code> (e.g., <code>http://localhost:3000/attachments/yourfile.jpg</code>). The <code>CDN_BASE_URL</code> is used to construct the full URL in API responses.</li>
            </ul>

            <h3 id="health-check">Health Check</h3>
            <h4 id="get-health"><code>GET /health</code></h4>
            <p>Provides the health status of the server.</p>
            <p><strong>Response (Success 200):</strong></p>
            <pre><code class="language-json">{
  "status": "OK",
  "timestamp": "YYYY-MM-DDTHH:mm:ss.sssZ",
  "uptime": 1234.56 // seconds
}</code></pre>

            <h2 id="websocket-events">ðŸ”Œ WebSocket Events</h2>
            <p>The API uses Socket.io for real-time communication, primarily for report updates.</p>
            <ul>
                <li><strong>Namespace</strong>: <code>/reports</code></li>
                <li><strong>Authentication</strong>: Connect to the namespace with a JWT token in the <code>auth</code> object:
                    <pre><code class="language-javascript">const socket = io('http://your-server-url/reports', {
  auth: {
    token: 'your-jwt-token'
  }
});</code></pre>
                </li>
            </ul>

            <h3 id="emitted-events-server-to-client">Emitted Events (Server to Client)</h3>
            <ul>
                <li><code>newReport</code>
                    <ul>
                        <li><strong>Payload</strong>: The newly created report object.</li>
                        <li><strong>Description</strong>: Emitted when a new report is successfully created and matches a client's subscribed region.</li>
                    </ul>
                </li>
                <li><code>updateReport</code>
                    <ul>
                        <li><strong>Payload</strong>: The updated report object.</li>
                        <li><strong>Description</strong>: Emitted when an existing report is updated and matches a client's subscribed region.</li>
                    </ul>
                </li>
            </ul>

            <h3 id="listened-events-client-to-server">Listened Events (Client to Server)</h3>
            <ul>
                <li><code>subscribeRegion</code>
                    <ul>
                        <li><strong>Payload</strong>:
                            <pre><code class="language-json">{
  "lat": 40.7128,    // Latitude of the center of the region
  "lng": -74.0060,   // Longitude of the center of the region
  "radius": 5000     // Radius in meters
}</code></pre>
                        </li>
                        <li><strong>Description</strong>: Allows a client to subscribe to real-time updates for reports within a specific geographical area. The server will then only send <code>newReport</code> and <code>updateReport</code> events relevant to this region.</li>
                    </ul>
                </li>
            </ul>

            <h2 id="data-models">ðŸ“Š Data Models</h2>
            <p>All models include <code>createdAt</code> and <code>updatedAt</code> timestamps by default.</p>

            <h3 id="user-model">User</h3>
            <ul>
                <li><code>name</code> (String, required)</li>
                <li><code>email</code> (String, required, unique, lowercase, trim)</li>
                <li><code>password</code> (String, required, minlength: 6) - Stored hashed.</li>
                <li><code>phone</code> (String, optional, trim)</li>
                <li><code>isAdmin</code> (Boolean, default: false)</li>
            </ul>

            <h3 id="pet-model">Pet</h3>
            <ul>
                <li><code>owner</code> (ObjectId, ref: 'User', optional, index: true) - The user who owns the pet.</li>
                <li><code>createdBy</code> (ObjectId, ref: 'User', required, index: true) - The user who created the pet record.</li>
                <li><code>name</code> (String, required, trim)</li>
                <li><code>breed</code> (String, optional, trim)</li>
                <li><code>height</code> (Number, optional, min: 0) - In cm.</li>
                <li><code>weight</code> (Number, optional, min: 0) - In kg.</li>
                <li><code>color</code> (String, optional, trim)</li>
                <li><code>photos</code> (Array of String URLs, default: []) - URLs of pet photos.</li>
                <li><code>isOwnedByCreator</code> (Boolean, default: true) - Indicates if the creator is the current owner.</li>
            </ul>

            <h3 id="report-model">Report</h3>
            <ul>
                <li><code>pet</code> (ObjectId, ref: 'Pet', required, index: true) - The pet this report is about.</li>
                <li><code>reporter</code> (ObjectId, ref: 'User', required, index: true) - The user who filed the report.</li>
                <li><code>status</code> (String, required, enum: ['lost', 'found', 'reunited'], default: 'lost', index: true)</li>
                <li><code>description</code> (String, optional, trim)</li>
                <li><code>photos</code> (Array of String URLs, default: []) - URLs of report-specific photos.</li>
                <li><code>location</code> (Object, required) - GeoJSON Point for the report's location.
                    <ul>
                        <li><code>type</code> (String, enum: ['Point'], required)</li>
                        <li><code>coordinates</code> (Array of Number, required, index: '2dsphere') - [longitude, latitude]</li>
                    </ul>
                </li>
                <li><code>resolvedAt</code> (Date, optional) - When the report was marked as 'reunited'.</li>
            </ul>
        </div> <!-- end of #markdown-content -->
    </div> <!-- end of .container -->

    <script>
        // Initialize highlight.js for code highlighting
        // Ensures that code blocks are highlighted after the DOM is fully loaded.
        document.addEventListener('DOMContentLoaded', (event) => {
            hljs.highlightAll();
        });
    </script>
</body>
</html>
